<!DOCTYPE html>
<html lang="en">
<head>
    <title>Home Listings - J&B Real Estate Partners</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script scr="js\script.js"></script>
    <link rel="stylesheet" href="css\style.css">
    <style>
        table{background: #f7fafc;}
        table td{border-bottom:1px solid #ccc;padding:4px;margin:0}
    </style>
    <script>
        var btn = document.getElementById("btn");
        var listingCont = document.getElementById("listing-cont");
        const url = "http://3.21.225.172:8080/api/realestate/all";
        const urlShort = "http://3.21.225.172:8080/api/";
        let minPrice = 0;
        let maxPrice = 10000000000000000000;
        function requestListings() {
            //request user entered parameter to determine low price and high price -- if fields left empty keep values as set above
            if (document.getElementById("min_price").value !== "") {
                minPrice = document.getElementById("min_price").value
            }
            if (document.getElementById("max_price").value !== "") {
                maxPrice = document.getElementById("max_price").value
            }
            console.log(minPrice);
            console.log(maxPrice);
            //add request value to url string to create final url
            const requestURL = url;
            const ourRequest = new XMLHttpRequest();
            ourRequest.open('GET', requestURL);
            ourRequest.onload =
                //use json function to read the text from the response and split into a javascript array
                function () {
                    var ourData = JSON.parse(ourRequest.responseText);
                    //scan through data to determine where there is a match in price
                    //calls function that generates table with array ourData
                    updateData(ourData);
                };
            ourRequest.send();
        }
        //fu
        function updateData(data) {
            //Clear out table data if it exists
            if (document.getElementById("records").innerHTML != ""){
                document.getElementById("records").innerHTML = "";
            }
            //generate updated table data
            let table = document.querySelector("table");
            generateTableHead(table);
            generateTable(table, data);
        }
        //function to create the row of table header data
        function generateTableHead(table) {
            const fields = ["First Name", "Last Name", "Year Built", "New Build", "Square Ft.", "Baths", "Beds", "Street", "City", "State", "Zip", "price", "phone", "Listing", "Photo"];
            let thead = table.createTHead();
            let row = thead.insertRow();
            for (let item of fields) {
                let th = document.createElement("th");
                let text = document.createTextNode(item);
                th.appendChild(text);
                row.appendChild(th);
            }
        }
        //function to create and fill the data fields of the results table
        function generateTable(table, data) {
            console.log(data);
            for (let object of data){
                for (let field in object) {
                    if (field == "price") {
                        let listingPrice = object[field];
                        console.log(listingPrice);
                        console.log(minPrice);
                        console.log(maxPrice);
                        if (listingPrice >= minPrice && listingPrice <= maxPrice) {
                            for (let element of data) {
                                let row = table.insertRow();
                                for (let key in element) {
                                    if (key !== "id"){
                                        if (key !== "imageurl") {
                                            let cell = row.insertCell();
                                            let text = document.createTextNode(element[key]);
                                            cell.appendChild(text);
                                            console.log(element[key] + key);
                                        }
                                        else {
                                            //displays the image in the last column, cell.appendChild(<img width=100 height=100 src='shortURL +
                                            let cell = row.insertCell();
                                            let imgURL = urlShort + element[key];
                                            console.log(imgURL);
                                            let picName = element[key];
                                            let text = "<a id= '" + picName + "' href='details.html'><img height=100 width=100 src='" + urlShort + element[key] + "' /></a>";
                                         //testing   let text = "<a id= '" + picName + "' " + "onclick= '" + setPicName() "' + href='details.html'><img height=100 width=100 src='" + urlShort + element[key] + "' /></a>";
                                            console.log(text);
                                            // document.createTextNode(text);
                                            // document.createTextNode(element[key]);
                                            cell.innerHTML = text;
                                            console.log(cell.innerHTML);
                                        }

                                    }


                                }
                            }


                        }

                    }
                }

            }

        }
    </script>
</head>
<body>
<div id="page-container">
<!--Navigation Bar-->
<div id="content-wrap">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="index.html">J & B Real Estate</a>
        </div>
        <ul class="nav navbar-nav">
            <li><a href="index.html">Home</a></li>
            <li class="active"><a href="#">Listings</a></li>
            <li><a href="connect.html">Connect</a></li>
            <li><a href="about.html">About Us</a></li>
        </ul>
    </div>
</nav>

<!--Page title-->
<div class="background jumbotron jumbotron-fluid text-center">
    <div class="transbox">
        <h1>Real Estate Listings</h1>
        <h3>Johnson & Burns Real Estate</h3>
    </div>
</div>

<!--main content-->
<div class="container-fluid main display-4">
    <form>
        <label for="min_price">Price Min:</label>
        <input type="text" id="min_price"><br>
        <label for="max_price">Price Max:</label>
        <input type="text" id="max_price"><br>
        <input type="button" id="btn" value="Search" onclick="requestListings()">
    </form>
    <div id="listing-cont" class="container">
        <p id="test"></p>

        <table id="records">
            <!-- here goes our data! -->
        </table>
    </div>
</div>
</div>
<!--footer-->

<footer id="footer">Johnson & Burns Proud Partners in Real Estate since &copy 2021</footer>
</div>
</body>


</html>