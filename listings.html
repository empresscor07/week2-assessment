<!DOCTYPE html>
<html lang="en">
<head>
    <title>Home Listings - J&B Real Estate Partners</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script scr="js\script.js"></script>
    <link rel="stylesheet" href="css\style.css">
    <style>
        table{background: #f7fafc;}
        table td{border-bottom:1px solid #ccc;padding:4px;margin:0}
    </style>
    <script>
        var btn = document.getElementById("btn");
        var listingCont = document.getElementById("listing-cont");
        const url = "http://3.21.225.172:8080/api/realestate/getByRowAmount?rows=";
        const urlShort = "http://3.21.225.172:8080/api/";
        function requestListings() {
            //request user entered parameter to determine how many records to pull
            const value_Requested = document.getElementById("num_rec").value
            //add request value to url string to create final url
            const requestURL = url + value_Requested;
            const ourRequest = new XMLHttpRequest();
            ourRequest.open('GET', requestURL);
            ourRequest.onload =
                //use json function to read the text from the response and split into a javascript array
                function () {
                    var ourData = JSON.parse(ourRequest.responseText);
                    //calls function that generates table with array ourData
                    updateData(ourData);
                };
            ourRequest.send();
        }
        //fu
        function updateData(data) {
            //Clear out table data if it exists
            if (document.getElementById("records").innerHTML != ""){
                document.getElementById("records").innerHTML = "";
            }
            //generate updated table data
            let table = document.querySelector("table");
            generateTableHead(table);
            generateTable(table, data);
        }
        //function to create the row of table header data
        function generateTableHead(table) {
            const fields = ["First Name", "Last Name", "Year Built", "New Build", "Square Ft.", "Baths", "Beds", "Street", "City", "State", "Zip", "Listing", "Photo"];
            let thead = table.createTHead();
            let row = thead.insertRow();
            for (let item of fields) {
                let th = document.createElement("th");
                let text = document.createTextNode(item);
                th.appendChild(text);
                row.appendChild(th);
            }
        }
        //function to create and fill the data fields of the results table
        function generateTable(table, data) {
            for (let element of data) {
                let row = table.insertRow();
                for (let key in element) {
                    if (key !== "id"){
                        let cell = row.insertCell();
                        let text = document.createTextNode(element[key]); cell.appendChild(text);
                    }

                }
            }
        }
    </script>
</head>
<body>

<!--Navigation Bar-->
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="index.html">J & B Real Estate</a>
        </div>
        <ul class="nav navbar-nav">
            <li><a href="index.html">Home</a></li>
            <li class="active"><a href="#">Listings</a></li>
            <li><a href="connect.html">Connect</a></li>
            <li><a href="about.html">About Us</a></li>
        </ul>
    </div>
</nav>

<!--Page title-->
<div class="background jumbotron jumbotron-fluid text-center">
    <div class="transbox">
        <h1>Real Estate Listings</h1>
        <h3>Johnson & Burns Real Estate</h3>
    </div>
</div>

<!--main content-->
<div class="container-fluid main display-4">
    <form>
        <label for="num_rec">Number of records:</label>
        <input type="text" id="num_rec"><br>
        <input type="button" id="btn" value="Update" onclick="requestListings()">
    </form>
    <div id="listing-cont" class="container">
        <p id="test"></p>

        <table id="records">
            <!-- here goes our data! -->
        </table>
    </div>
</div>

<!--footer-->

<footer>Johnson & Burns Proud Partners in Real Estate since &copy 2021</footer>

</body>
</html>